---
layout: article
title: 机器人路径规划算法（四）拓扑连通图的构建方法2
tag: [Path Planning]
excerpt: 介绍路径规划中基于概率完备拓扑连通图的构建算法
---
# PRM(Probabilistic RoadMap)

## 基本思想
通过随机采样和碰撞检测找到自由位形空间中的路径点和无碰路径，构成连通图

- 在位形空间坐标系中随机取点
- 对采样的点进行碰撞检测，把无碰撞姿态作为图节点
- 每个图节点和其最近相邻的k个节点直线连接，保留无碰路径作为图的边
- 即可构成自由位形空间中的RoadMap，加入起始点和终止点

<div style="text-align: center"><img src="https://cdn.jsdelivr.net/gh/Mronne/MarkDownImg/img/20200326110745.jpg"/></div>

- 在PRM中搜索一条从起始点到终止点的路径

<div style="text-align: center"><img src="https://cdn.jsdelivr.net/gh/Mronne/MarkDownImg/img/20200326105705.jpg"/></div>
## 需考虑的几个问题
- 随机位形选择 采用均匀随机采样方式
- 寻找最近邻点 采用KD树方法加速
- 生成局部路径 在一定范围内直接连接图节点
- 检查路径无碰 可以增量式取点或者二分法取点，判断点是否在障碍物区域内
- 进行路径优化
    - 从目标点开始依次找它前面的点，检测是否发生碰撞
    - 假如未发生碰撞，继续往前寻找，直到路径发生碰撞，将目标点与当前点的上一个点连接
    - 从当前点开始继续此优化过程
- 非全联通情况
    - 环境复杂，存在狭窄通道等困难场景时，会存在图非联通的情况
    - 对节点进行困难度表示，节点一定距离范围内的节点的倒数、该节点到不与该节点联通的最近连通单元距离倒数、局部路径规划失败率
    - 以困难度作为该节点被选择为扩张节点的概率
    - 选择后，从该节点出发随机选择方向运动，碰到障碍物后再随机选择方向运动，循环若干次直至成功建立与其他联通单元的连接

<div style="text-align: center"><img src="https://cdn.jsdelivr.net/gh/Mronne/MarkDownImg/img/20200326110138.png"/></div>

## 特点
- 优点
    - 简化了对环境的解析计算，可快速得到行车图
    - 适用于高维自由位形空间中的规划
    - 是近似完备的路径规划
- 缺点
    - 对自由空间连通性表达的完整性依赖于采样次数
    - 难以评估需要多少时间进行充分采样
    - 不考虑机器人的执行可行性

# RRT(Rapid-Exploring Random Tree)
## 基本思想
- 连通图采用树的形式，以起始点作为树的根节点
- 在空间中随机采样、连接树中最近节点的方式拓展树
- 考虑机器人的运动执行能力
- 通过树结构可直接回溯得到路径

## 流程
- 以初始状态$q_{init}$为根节点，建立搜索树
- 循环以下步骤，完成树的扩张过程
    - 在状态空间中，随机采样一个状态，用于引导搜索树的扩张，称为$q_{rand}$
    - 在现有的搜索树上查找与$q_{rand}$距离最近的节点$q_{near}$，以$q_{near}$和$q_{rand}$构建新的输入$\mathbf{u}$，以$q_{near}$作为当前状态$\mathbf{x}$，根据系统的状态方程$\dot{x}=f(x, u)$，得到下一个状态即搜索树的扩张节点$q_{new}$
    - 对$q_{new}$进行碰撞检测，如果无冲突，则将$q_{new}$加入到搜索树中，实现扩张
    - 判断$q_{new}$是否满足以下两个终止条件，满足任意一个即终止，否则继续循环扩张搜索树
        - 如果$q_{new}$为运动规划的目标状态$q_{goal}$，则返回Success
        - 搜索树的规模已经足够大，循环次数达到上限，可判断没有可行路径，则返回Fail
    - 如果收到Success则规划成功，返回从初始状态$q_{init}$到$q_{goal}$的树的节点路径，否则规划失败。

<div style="text-align: center"><img src="https://cdn.jsdelivr.net/gh/Mronne/MarkDownImg/img/20200326161631.png"/></div>

<div style="text-align: center"><img src="https://cdn.jsdelivr.net/gh/Mronne/MarkDownImg/img/20200326161818.png"/></div>

## 分析
- 影响规划收敛速度的三个因素：
    - 随机状态的采样位置
    - 在搜索树中查找与随机状态距离最近的节点
    - 新生成节点的防撞检测

## 改进
- 双向RRT
针对RRT扩展偏向于空间未探测的部分，但不是偏向目标点，当环境复杂时计算效率较低。采用双向RRT的方式从起始点和目标点分别扩张，提高计算效率。

- RRT*
针对RRT随机性扩展步长小导致的路径曲折，成本较高。
    - 寻找书中新节点邻域内到新节点路径最短的节点，建立连接，加入树集合
    - 对树中新节点邻域内的节点进行判断，如果从新节点到该节点形成的路径优于现有树中路径，则将该节点的父节点修改为新节点

<div style="text-align: center"><img src="https://cdn.jsdelivr.net/gh/Mronne/MarkDownImg/img/20200326164123.png"/></div>

# 发展趋势
- 将路径规划转为马尔可夫决策问题，采用深度学习/强化学习进行求解。
- 综合考虑与环境中人的交互，学习地图成本，构建成本地图
